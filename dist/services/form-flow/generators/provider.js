"use strict";var v=Object.defineProperty,_=Object.defineProperties,E=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertyNames,I=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var M=(m,e,F)=>e in m?v(m,e,{enumerable:!0,configurable:!0,writable:!0,value:F}):m[e]=F,w=(m,e)=>{for(var F in e||(e={}))y.call(e,F)&&M(m,F,e[F]);if(I)for(var F of I(e))D.call(e,F)&&M(m,F,e[F]);return m},B=(m,e)=>_(m,j(e));var G=(m,e)=>{for(var F in e)v(m,F,{get:e[F],enumerable:!0})},J=(m,e,F,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of q(e))!y.call(m,t)&&t!==F&&v(m,t,{get:()=>e[t],enumerable:!(a=E(e,t))||a.enumerable});return m};var K=m=>J(v({},"__esModule",{value:!0}),m);var N=(m,e,F)=>new Promise((a,t)=>{var p=h=>{try{c(F.next(h))}catch(x){t(x)}},u=h=>{try{c(F.throw(h))}catch(x){t(x)}},c=h=>h.done?a(h.value):Promise.resolve(h.value).then(p,u);c((F=F.apply(m,e)).next())});var X={};G(X,{generateProvider:()=>Q});module.exports=K(X);var C=require("react");var O=require("react"),A=({flowStore:m,currentStep:e})=>(0,O.useMemo)(()=>{var x,P,S,g,V;let F=m.getHead(),a=m.getTail(),t=(e==null?void 0:e.index)===(F==null?void 0:F.index),p=(e==null?void 0:e.index)===(a==null?void 0:a.index),u=(P=(x=e==null?void 0:e.previousStep)==null?void 0:x.identifier)!=null?P:null,c=(S=e==null?void 0:e.identifier)!=null?S:null,h=(V=(g=e==null?void 0:e.nextStep)==null?void 0:g.identifier)!=null?V:null;return{isFirstStep:t,isLastStep:p,previousStepIdentifier:u,currentStepIdentifier:c,nextStepIdentifier:h}},[e]);function R({flowStore:m,getFields:e,updateFields:F,isFormFlowResumable:a}){let[t,p]=(0,C.useState)(null),u=(0,C.useMemo)(()=>{let S=t==null?void 0:t.Component;return S?()=><S storeFields={e()}updateStoreFields={F}moveToNextStep={h}moveToPreviousStep={x}moveToStepByIdentifier={P}/>:()=><></>},[t]),c=A({flowStore:m,currentStep:t});(0,C.useEffect)(()=>{let S=a?m.getLastIncompleteStep(e()):m.getHead();p(S)},[]);let h=()=>{let S=m.getNextValidStep(t,e());p(S)},x=()=>{let S=m.getPreviousValidStep(t,e());p(S)},P=S=>{let g=m.getStepByIdentifier(S);p(g)};return{currentStep:t,meta:c,CurrentStepView:u,moveToNextValidStep:h,moveToPreviousValidStep:x,moveToStepByIdentifier:P}}var L=require("react");var U=({initialStoreFields:m,onStoreUpdate:e})=>{let F=(0,L.useRef)(m),a=()=>F.current;return{getFields:a,updateFields:p=>N(void 0,null,function*(){let u=a(),c=w(w({},u),p);F.current=c,e&&(yield e(c))})}};var H=require("react"),W=({flowStore:m,getFields:e,currentStep:F})=>({progressPercentage:(0,H.useMemo)(()=>{let{currentStepIndex:p,numberOfValidSteps:u}=m.getTotalOfValidSteps(F,e());return p/u*100},[F])});var b=class{constructor({isAValidationView:e,previousStep:F,nextStep:a,doesMeetConditionFields:t,Component:p,index:u,identifier:c,willBePartOfTheFlow:h}){this.index=u,this.identifier=c,this.Component=p,this.isAValidationView=!!e,this.previousStep=F,this.nextStep=a,this.doesMeetConditionFields=t||(()=>!0),this.willBePartOfTheFlow=h||(()=>!0)}};var T=class{constructor(e){this.getHead=()=>this.head;this.getTail=()=>this.tail;this.getNextValidStep=(e,F)=>{var u;let a=(e==null?void 0:e.index)===((u=this.tail)==null?void 0:u.index),t=(e==null?void 0:e.nextStep)||null;if(!e||a||!t)return null;let p=((e==null?void 0:e.index)||0)+1;for(let c=p;c<=this.length;c++){if(t==null?void 0:t.doesMeetConditionFields(F))return t;t=(t==null?void 0:t.nextStep)||null}return null};this.getPreviousValidStep=(e,F)=>{var p;let a=(e==null?void 0:e.index)===((p=this.head)==null?void 0:p.index),t=e==null?void 0:e.previousStep;if(!e||a||!t)return null;for(let u=this.length-1;u>=0;u--){let c=!!(t!=null&&t.doesMeetConditionFields(F)),h=!(t!=null&&t.isAValidationView);if(c&&h)return t;t=(t==null?void 0:t.previousStep)||null}return null};this.getTotalOfValidSteps=(e,F)=>{let a=0,t=0,p=this.getHead();for(let u=0;u<=this.length;u++){let c=!!(p!=null&&p.willBePartOfTheFlow(F)),h=!(p!=null&&p.isAValidationView);(p==null?void 0:p.index)===(e==null?void 0:e.index)&&(a=t),c&&h&&t++,p=(p==null?void 0:p.nextStep)||null}return{numberOfValidSteps:t,currentStepIndex:a}};this.getLastIncompleteStep=e=>{let F=this.head,a=this.head;for(let t=0;t<this.length;t++){let p=!(a!=null&&a.isAValidationView),u=!!(a!=null&&a.doesMeetConditionFields(e)),c=!!(a!=null&&a.willBePartOfTheFlow(e));p&&u&&c&&(F=a),a=(a==null?void 0:a.nextStep)||null}return F};this.getStepByIdentifier=e=>{let F=this.head;for(let a=0;a<this.length;a++){if((F==null?void 0:F.identifier)===e)return F;F=(F==null?void 0:F.nextStep)||null}return null};this.initializeSteps=e=>{for(let[F,a]of e.entries()){let t=new b(B(w({},a),{previousStep:this.tail,nextStep:null,index:F}));this.head===null&&(this.head=t),this.tail!==null&&(this.tail.nextStep=t),this.tail=t,this.length+=1}return this};this.head=null,this.tail=null,this.length=0,this.initializeSteps(e)}};function Q({context:m,steps:e}){let F=m.Provider;return({initialStoreFields:a,onStoreUpdate:t,isResumable:p=!1,children:u})=>{let c=new T(e),{getFields:h,updateFields:x}=U({initialStoreFields:a,onStoreUpdate:t}),{currentStep:P,meta:S,CurrentStepView:g,moveToNextValidStep:V,moveToPreviousValidStep:k}=R({flowStore:c,getFields:h,updateFields:x,isFormFlowResumable:p}),{progressPercentage:z}=W({flowStore:c,getFields:h,currentStep:P});return<F value={{getStoreFields:h,updateStoreFields:x,CurrentStepView:g,moveToPreviousValidStep:k,moveToNextValidStep:V,progressPercentage:z,meta:S}}>{u}</F>}}0&&(module.exports={generateProvider});
